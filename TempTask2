using System;
using System.Collections.Generic;
using System.Linq;
using System.Text;
using System.Threading.Tasks;
using System.Globalization;

namespace Task1
{
    class Program
    {
        static void Main(string[] args)
        {
            bool isOpen = true;
            string userInput;
            Player player = new Player();
            Merchant merchant = new Merchant();
            Console.WriteLine("Добро пожаловать в лавку");
            Console.WriteLine("1.Показать инвентарь. 2.Показать товары. 3.Купить. 4.Выйти из лавки");

            while (isOpen)
            {
                userInput = Console.ReadLine();

                switch (userInput)
                {
                    case "1":
                        player.ShowInventory();
                        break;
                    case "2":
                        merchant.ShowGoods();
                        break;
                    case "3":
                        player.BuyGoods(merchant);
                        break;                   
                    case "4":
                        isOpen = false;
                        break;
                }
            }
        }
    }
              
    class Item
    {
        public List<Item> Items = new List<Item>();
        public string Name { get; private set; }
        public string Stats { get; private set; }
        public int Price { get; private set; }
        public int Amount { get; private set; }

        public Item(string name, string stats, int price, int amount)
        {
            Name = name;
            Stats = stats;
            Price = price;
            Amount = amount;
        }

        public void ShowItem(int itemID)
        {
            Console.WriteLine($"{itemID + 1}.{Name}, Параметры: {Stats}, Цена: {Price}, Количество: {Amount}");
        }

        public void ReduceCount(int count)
        {
            if (count <= Amount)
                Amount -= count;
        }
    }
    
    class Merchant
    {
        private int _storeAccount = 200;

        public List<Item> Store = new List<Item>();
        
        public Merchant()
        {
            Store.Add(new Item("Шлем отваги", "Атака +1", 30, 1));
            Store.Add(new Item("Фляга клея", "Инициатива +2", 40, 2));
            Store.Add(new Item("Хотельное кольцо", "Проклятье -1", 50, 1));
            Store.Add(new Item("Утка обречённости", "Уровень -2", 60, 2));
            Store.Add(new Item("Зелье идиотской храбрости", "Атака +2", 20, 3));
        }

        public void ShowGoods()
        {
            Console.WriteLine($"Товары в магазине    Деньги торговца{_storeAccount}");

            for (int i = 0; i < Store.Count; i++)
            {
                Store[i].ShowItem(i);
            }
        }

        public void SellGoods(int itemID)
        {
            _storeAccount += Store[itemID - 1].Price;
        }
    }
    class Player
    {
        private string _name;
        private int _count;
        private int _money = 100;
        private List<Player> _inventory = new List<Player>();

        public Player(string name, int count)
        {
            _name = name;
            _count = count;
        }
        public Player() { }

        public void ShowInventory()
        {
            Console.WriteLine($"Ваши вещи    Ваши деньги {_money}");

            if (_inventory.Count == 0)
            {
                Console.WriteLine("Ваш инвентарь пуст");
            }
            else
            {
                for (int i = 0; i < _inventory.Count; i++)
                {
                    Console.WriteLine($"{_inventory[i]._name} количество {_inventory[i]._count}");
                }
            }            
        }

        public void BuyGoods(Merchant merchant)
        {
            int itemID;
            int itemCount;
            Console.WriteLine("Что вы хотите купить?");
            itemID = GetNumber();
            Console.WriteLine("Сколько вы хотите купить?");
            itemCount = GetNumber();

            if (itemID <= merchant.Store.Count)
            {
                if (itemCount <= merchant.Store[itemID - 1].Amount)
                {
                    if (_money - merchant.Store[itemID - 1].Price * itemCount > 0)
                    {
                        _money -= merchant.Store[itemID - 1].Price * itemCount;
                        merchant.SellGoods(itemID);
                        merchant.Store[itemID - 1].ReduceCount(itemCount);
                        if (IsItemExist(itemID))
                        {
                            _inventory[itemID - 1]._count += itemCount;
                        }
                        else
                        {
                            _inventory.Add(new Player(merchant.Store[itemID - 1].Name, itemCount)); 
                        }
                    }
                    else
                    {
                        Console.WriteLine("У вас не хватает денег!");
                    }
                }
                else
                {
                    Console.WriteLine("Извините, у нас нет такого количества");
                }
            }
            else
            {
                Console.WriteLine("Извините, у нас нет такого товара");
            }            
        }

        public bool IsItemExist(int itemID)
        {
            Merchant merchant = new Merchant();
            string itemInStore = merchant.Store[itemID - 1].Name;
            string itemInInventory = string.Empty;

            for (int i = 0; i < _inventory.Count; i++)
            {
                if (_inventory[i]._name == itemInStore)
                {
                    itemInInventory = itemInStore;
                    break;
                }
            }

            if (itemInInventory == itemInStore)
            {
                return true;
            }
            else
            {
                return false;
            }
        }

        private int GetNumber()
        {
            bool isNumber = int.TryParse(Console.ReadLine(), out int number);

            if (isNumber == false)
            {
                Console.WriteLine("Введите число");
                number = 0;
                return number;
            }
            else
            {
                return number;
            }
        }
    }
}
